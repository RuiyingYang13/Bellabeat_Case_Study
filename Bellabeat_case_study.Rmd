---
title: "Bellabeat Case Study"
author: "Ruiying Yang"
output: 
  html_document: 
    toc: yes
    theme: cerulean
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### 1. All about the company - Bellabeat
Bellabeat is a high-tech manufacturer of health-focused products for women and it is a successful small company, but they have the potential to become a larger player in the global smart device market. Urška Sršen, cofounder and Chief Creative Officer of Bellabeat, believes that analyzing smart device fitness data could help unlock new growth opportunities for the company.

### 2. Ask
#### 2.1 Identify the business task
1. What are some trends in smart device usage?
2. How could these trends apply to Bellabeat customers?
3. How could these trends help influence Bellabeat marketing strategy?

#### 2.2 Key stakeholders
1. Urška Sršen: Bellabeat’s cofounder and Chief Creative Officer.
2. Sando Mur: Mathematician and Bellabeat’s cofounder.
3. Bellabeat marketing analytics team.

### 3. Prepare
#### 3.1 Basic Info of the data
1. This dataset generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Thirty eligible Fitbit users consented to the submission of personal tracker data.  
2. There might be some problem with bias, because the data only comes from Fitbit users. That means the data with other resources are not considered. They did not indicate how did they choose the 30 data, randomly or according to certain patterns. The data is also chosen in a certain time of period. It might also cause bias.
3. From the metadata we can see that the license is CC0: Public Domain. The data is opened for public and accessible on Kaggle.  

#### 3.2 The structure and some basic statistic info of the data
##### 3.2.1 Install the necessary packages and import the data. 

```{r}
#install.packages("sqldf")
library(pacman)
p_load(moments,
       ggplot2,
       cowplot,
       RColorBrewer,
       stargazer,
       tidyverse,
       sqldf,
       lubridate,
       dplyr)

getwd()

Activity <- read.csv("/Users/yangruiying/Desktop/Data\ Analyse/Bellabeat_Case_Study/Fitabase\ Data/dailyActivity_merged.csv", stringsAsFactors = T, header = T, sep = ",")

Calories <- read.csv("/Users/yangruiying/Desktop/Data\ Analyse/Bellabeat_Case_Study/Fitabase\ Data/dailyCalories_merged.csv", stringsAsFactors = T, header = T, sep = "," )

Steps <- read.csv("/Users/yangruiying/Desktop/Data\ Analyse/Bellabeat_Case_Study/Fitabase\ Data/dailySteps_merged.csv", stringsAsFactors = T, header = T, sep = "," )

Weight <- read.csv("/Users/yangruiying/Desktop/Data\ Analyse/Bellabeat_Case_Study/Fitabase\ Data/weightLogInfo_merged.csv", stringsAsFactors = T, header = T, sep = "," )

Intensity <- read.csv("/Users/yangruiying/Desktop/Data\ Analyse/Bellabeat_Case_Study/Fitabase\ Data/dailyIntensities_merged.csv", stringsAsFactors = T, header = T, sep = "," )

Sleep <- read.csv("/Users/yangruiying/Desktop/Data\ Analyse/Bellabeat_Case_Study/Fitabase\ Data/sleepDay_merged.csv", stringsAsFactors = T, header = T, sep = "," )

HourlyIntensity <- read.csv("/Users/yangruiying/Desktop/Data\ Analyse/Bellabeat_Case_Study/Fitabase\ Data/hourlyIntensities_merged.csv", stringsAsFactors = T, header = T, sep = "," )
```

##### 3.2.2  How the data is organized. 
```{r}
str(Activity)
head(Activity)

str(Calories)
head(Calories)

str(Steps)
head(Steps)

str(Weight)
head(Weight)

str(Intensity)
head(Intensity)

str(Sleep)
head(Sleep)

str(HourlyIntensity)
head(HourlyIntensity)
```

- Activity table: 
There are 940 records and 15 variables, most of the data are numerical and integer. Many people recorded their activity for many days. Most of the variables are grouped according to the amount and intensity of the activities.
- Calories table: 
There are 940 obs. of  3 variables. The data is also grouped by different customer Ids. But we can notice that, the data in the table calories overlapped with the data in the table Activity. So the data in this table can be just replaced with the analysis of the data in the table Activity.
- Steps table:
There are also 940 obs. of  3 variables. The case for this table is the same as the table calories. Because all the variables are included in the Activity data, this table will not be included in our analysis. 
- Weight table:
There are 67 obs. of  8 variables. Since there are some different rows in this table and there is also Id column, so it can be merged with the data in the table Acitivity.
- Intensity table: 
There are 940 obs. of  10 variables. All the data are included in the table Acitivity, so we will exclude this table from our analysis.
- Sleep table:
There are 413 obs. of  5 variables. We can see that many users record their sleep for many different days, which means maybe what the most important function of the fitness app is to record the sleep. We can still merge this data with the data in the table Activity.
- HourlyIntensity table:
There are 22099 obs. of 4 variables. There are so many objects in this table because the intensity is recorded for many times in a day. Since the data in the table Intensity is overlapped with the data in Activity table, we could use this table to examine the time period of doing sport.

We can also notice that the data is store in the long format.
After the first peek into the data, we decided that we will analyze the following tables:
• Activity
• Weight
• Sleep
• HourlyIntensity

##### 3.2.3 Statistical information of the data
```{r}
summary(Activity)
summary(Weight)
summary(Sleep)
summary(HourlyIntensity)

n_distinct(Activity$Id)
n_distinct(Weight$Id)
n_distinct(Sleep$Id)
n_distinct(HourlyIntensity$Id)
```

- Activity  
• Insights of the Activity data:  
The data in this table comes from 33 different users.  
Firstly, most of the users are lightly active.The very active minutes is on average only 15 minutes. Usually they sit for almost 16 hours and walk for 3.6km every day. That means the target customers are not so super active or sporty. 
Secondly, on average women burn 2300 calories, which is not too much. According to NHS.UK, only the people who do lightly active work burn 2300 calories.  
• Suggestion according to the insights of the data:  
To remain health, mentally and physically, on one hand, the target customer should first reduce their sedentary hours from 16 hours to 10 hours. Medical researchers have long warned that prolonged sitting is dangerous, associated with a significantly higher risk of heart disease, diabetes, obesity, cancer, and depression, as well as muscle and joint problems. 
On the other hand, the CDC recommend that most adults aim for 10,000 steps per day. For most people, this is the equivalent of about 8 kilometers, or 5 miles.
So the targeted customers should also walk more.
Last but not least, the targeted customer should burn more calories per day if they want to lose weight. The suggested calories to burn to lose weight is between 2500 - 3000 calories.

- Weight  
• Insights of the Weight data:  
The data in this table comes from 8 different users.  
From this table we know that the average weight of the customers are 72kg, although we do not know the average height, but according to the BMI average value of 25.19, we know the customers are slightly overweighted. Because if the BMI is 18.5 to 24.9, it falls within the normal or Healthy Weight range.  
• Suggestion according to the insights of the data:  
The customers should try to lose weight and control their BMI in the range of 18.5 to 24.9.

- Sleep  
• Insights of the Sleep data:  
The data in this table comes from 24 different users.  
On average, the customers sleep 419 minutes which equals almost 7 hours. That is a good result.

- HourlyIntensity  
• Insights of the HourlyIntensity data:  
The data in this table comes from 33 different users.  
On average, the TotalIntensity is 12.

### 4. Process
#### 4.1 Missing values
```{r}
# Check for explicit and implicit missing values
colSums(is.na(Activity))
colSums(Activity == "")

colSums(is.na(Weight))
colSums(Weight == "")

colSums(is.na(Sleep))
colSums(Sleep == "")

colSums(is.na(HourlyIntensity))
colSums(HourlyIntensity == "")

Weight <- Weight[, -5]
str(Weight)
```

We can notice that, there are no missing values in those tables except the table Weight. According to the analysis from the last step we know that there are totally 67 records, but there are 65 missing values in the column 65, which means almost all the data are missed. So this column will be dropped and not considered in the further analysis. 

#### 4.2 Duplicates
```{r}
sum(duplicated(Activity))
sum(duplicated(Weight))
sum(duplicated(Sleep))
sum(duplicated(HourlyIntensity))

Sleep <- Sleep %>% 
  distinct()
```

We can see that there are 3 duplicates in the table Sleep. The duplicates are deleted.

#### 4.3 Consistency of date and time columns
```{r}
head(Activity)
head(Weight)
colSums(is.na(Weight))
head(Sleep)
str(HourlyIntensity)

names(Activity)[names(Activity) == "ActivityDate"] <- "Date"
names(Sleep)[names(Sleep) == "SleepDay"] <- "Date"

Activity$Date <- as.POSIXct(Activity$Date, format = "%m/%d/%Y", tz=Sys.timezone())
Sleep$Date <- as.POSIXct(Sleep$Date, format = "%m/%d/%Y %I:%M:%S %p", tz=Sys.timezone())

HourlyIntensity$ActivityHour <- as.POSIXct(HourlyIntensity$ActivityHour, format = "%m/%d/%Y %I:%M:%S %p", tz=Sys.timezone())
HourlyIntensity$Time <- format(HourlyIntensity$ActivityHour, format = "%H:%M:%S")
Weight$Date <- as.POSIXct(Weight$Date, format = "%m/%d/%Y %I:%M:%S %p", tz=Sys.timezone())
```

Now that the type of date and time columns are datetime, we can now merge the data.

#### 4.4 Merge the data
```{r}
ASdata <- merge(Activity, Sleep, by = c("Id", "Date"))
head(ASdata)
```

### 5. Analyze and Share
#### 5.1 The relationship between BMI and WeightKg
```{r}
ggplot(Weight, aes(x = WeightKg, y = BMI)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method='lm',
              se = TRUE,
              colour = 'coral') +
  geom_smooth(method='loess',
              se = FALSE,
              colour = 'royalblue') +
  labs(title = "The relationship between WeightKg and BMI",
       x = "WeightKg",
       y = "BMI") +
  theme(plot.title = element_text(color = "royalblue4", face = "bold", 
                                  size = 10, hjust =0.5),
        axis.title.x = element_text(color = "royalblue4", size = 8, 
                                    face = "italic", hjust =0.5, vjust = 1),
        axis.title.y = element_text(color = "royalblue4", size = 8, 
                                    face = "italic", hjust =0.5, vjust = 1))
```

• Insights from the graph:  
From this graph we can see that there is clearly a linear relationship between WeightKg and BMI. The more weight one has, the more BMI one gets.  
• Suggestion according to the insights:  
If customers want to get good BMI, they need to first lose weight. We can calculate how much weight they need to lose to get the targeted BMI. To do that, we will model the linear relationship so that the values of the both variables can be calculated.

##### 5.1.1 Modelling the relationship and evaluating the model
```{r}
# Modelling
lm0 <- lm(BMI ~ WeightKg, data = Weight)
summary(lm0)

# Predict
pred.lm0 <- predict(lm0, newdata = Weight) 
summary(pred.lm0)

# Errors that might exist between our Model and predict values
(MAE.lm0 <- mean(abs(Weight$BMI - pred.lm0)))
```

There is an error of 1.38 which means our model performance is really good.

To have lose weight, people need to burn calories, Let's have a look how to better control calories.

#### 5.2 Relationships between TotalDistance and Calories
```{r}
ggplot(ASdata, aes(x = TotalDistance, y = Calories)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method='lm',
              se = TRUE,
              colour = 'coral') +
  geom_smooth(method='loess',
              se = FALSE,
              colour = 'royalblue') +
  labs(title = "The relationship between TotalDistance and Calories",
       x = "TotalDistance",
       y = "Calories") +
  theme(plot.title = element_text(color = "royalblue4", face = "bold", 
                                  size = 10, hjust =0.5),
        axis.title.x = element_text(color = "royalblue4", size = 8, 
                                    face = "italic", hjust =0.5, vjust = 1),
        axis.title.y = element_text(color = "royalblue4", size = 8, 
                                    face = "italic", hjust =0.5, vjust = 1))
```

• Insights from the graph:  
From this graph we can see that there is clearly a linear relationship between TotalDistance and calories. The more one walks, the more calories one burns  
• Suggestion according to the insights:  
If the customer wants to burn more calories, we can calculate how much distance they need to walk according to the amount of calories they want to burn. To do that, we will model the linear relationship so that the values of the both variables can be calculated.

##### 5.2.1 Modelling the relationship and evaluating the model
```{r}
# Modelling
lm1 <- lm(TotalDistance ~ Calories, data = ASdata)
summary(lm1)

# Predict
pred.lm1 <- predict(lm1, newdata = ASdata) 
summary(pred.lm1)

# Errors that might exist between our Model and predict values
(MAE.lm1 <- mean(abs(ASdata$TotalDistance - pred.lm1)))
```

Based on the model we get, we can predict the new data if we have. Since we do not have any new data, we just evaluated our model using the same data. The MAE is only 2.139, which means our model's performance is pretty good.

Notice that people need to walk more if they want to lose calories, let us have a look when do people do sport more intensively.

#### 5.3 The timely intensity of doing activities.
```{r}
str(HourlyIntensity)
int_new <- HourlyIntensity %>% 
  group_by(Time) %>% 
  summarise(mean_total_int = mean(TotalIntensity))

ggplot(int_new, aes(x = Time, y = mean_total_int)) +
  geom_histogram(stat = "identity", fill='#C5CAE9') +
  labs(title = "The hourly distribution of the intensity",
       x = "Hour",
       y = "Intensity") +
  theme(plot.title = element_text(color = "royalblue4", face = "bold", 
                                  size = 10, hjust =0.5),
        axis.title.x = element_text(color = "royalblue4", size = 8, 
                                    face = "italic", hjust =0.5, vjust = 1),
        axis.title.y = element_text(color = "royalblue4", size = 8, 
                                    face = "italic", hjust =0.5, vjust = 1),
        axis.text.x = element_text(angle = 90))
```

• Insights from the graph:  
From this graph we can see that there is from 17:00 to 19:00 people is most active. This is probably because that in this time period people just finish their work or school.
• Suggestion according to the insights:  
If the customers want to get more exercises, a notification in this time of period is the best.

After examining the factors which are related to the activities, let us have a look at the factor sleep.

#### 5.4 Relationships between sleeptime and other factors.
```{r}
A <- 
ggplot(ASdata, aes(x = TotalMinutesAsleep, y = TotalTimeInBed)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method='lm',
              se = TRUE,
              colour = 'coral') +
  geom_smooth(method='loess',
              se = FALSE,
              colour = 'royalblue') +
  labs(title = "The relationship between TotalMinutesAsleep and TotalTimeInBed",
       x = "TotalMinutesAsleep",
       y = "TotalTimeInBed") +
  theme(plot.title = element_text(color = "royalblue4", face = "bold", 
                                  size = 10, hjust =0.5),
        axis.title.x = element_text(color = "royalblue4", size = 8, 
                                    face = "italic", hjust =0.5, vjust = 1),
        axis.title.y = element_text(color = "royalblue4", size = 8, 
                                    face = "italic", hjust =0.5, vjust = 1))

B <-
ggplot(ASdata, aes(x = SedentaryMinutes, y = TotalMinutesAsleep)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method='lm',
              se = TRUE,
              colour = 'coral') +
  geom_smooth(method='loess',
              se = FALSE,
              colour = 'royalblue') +
  labs(title = "The relationship between SedentaryMinutes and TotalMinutesAsleep",
       x = "SedentaryMinutes",
       y = "TotalMinutesAsleep") +
  theme(plot.title = element_text(color = "royalblue4", face = "bold", 
                                  size = 10, hjust =0.5),
        axis.title.x = element_text(color = "royalblue4", size = 8, 
                                    face = "italic", hjust =0.5, vjust = 1),
        axis.title.y = element_text(color = "royalblue4", size = 8, 
                                    face = "italic", hjust =0.5, vjust = 1))

plot_grid(A, B)
```

• Insights from the graph:  
On one hand, we can see that, the more one stays in bed, the more they can sleep.  
On the other hand, it is the best when people sit for about 500 minute per day, which is around 8 hours. If they sit more than 8 hours, the more they sit, the less time they have to sleep.

• Suggestion according to the insights:  
If the customer wants to improve their sleep, they are encouraged to stay in bed for a longer time and do not sit for more than 8 hours. If they sit less than 8 hours, they should also sit longer. For better calculation, we still make a model and do predictions and evaluate our model's performance.

##### 5.4.1 Modelling the relationship and evaluating the model
```{r}
lm2 <- lm(TotalMinutesAsleep ~ TotalTimeInBed + SedentaryMinutes, data = ASdata)
summary(lm2)

pred.lm2 <- predict(lm2, newdata = ASdata) 
summary(pred.lm2)

(MAE.lm2 <- mean(abs(ASdata$TotalMinutesAsleep - pred.lm2)))
```

The MAE value is around 25, which means our model's performance is not bad.

### 6. Act
#### 6.1 The general trends
Nowdays people do little sports and they sit for too long. As a result of that, they do not burn so much calories everyday and they might be overweighted. The sleep quality is also not perfect. All of those mentioned above could result in pysically and mentally dieseases.

#### 6.2 To apply to Bellabeat customers
The targeted customers of Bellabeat is those who lightly active and a little bit overweighted women.
These kind of customer's purpose of maintaining of using fitness services could be divided into two aspects: lose weight and improve the sleep quality. Accoding to our data, we draw the following conclusion:  

• People need to reduce the sedentary time from 16 hours to 10 hours per day.  

• They should also walk more, the best would be that the customers could walk for at least 5 miles every day.  

• If they could reach the two targets above, they could then burn 2500 to 3000 calories every day and get a better BMI.  

• To improve their sleep quality, they could try to stay on bed for a longer time and sit for 8 hours every day.  

	
#### 6.3 Marketing strategy for now:

• Bellabeat could set some healthy thresholds for the customer. For example, they could set the daily sit hour as 10 hours, daily walk miles as 5 miles, daily time spend on bed is 500 mintues, daily calories to burn is 2500.  
With those threshold, people who wants to generally improve their health can have a better control of their daily activities.  

• Bellabeat could use our models to develop a calculate function. 
Because we have already divided our cutomers into two different categories: the one who wants to lose weight and the one who wants to improve the sleep.  
According to the different type of cutomers, bellabeat could set a function which enable customers to chooes their purposes to use fitness app. Different customers could set the healthy threshold by themselves.  
For example, someone wants to lose weight and they just set the targeted value of the weight. Accoding to the calculate function, customers could check how much they need to walk and sit. For the customers who want to improve their sleep, they could also enter a value of how long they want to sleep more. According to the calculate function, the time to sit and to walk can be also notified to the customer.  
In this way, the fitness app could help the cutomers to acheive their goals more efficiently.  

• Through our analysis we found out that during 17-19:00, the intensities of acitivites is the highest, so Bellbeat could set a notification at 17 to enable customers to check, if they have already reach the basic threshold or the threshold they set by themselves every day. If not, they could still do some more to achieve the goals for the day.  

• For the customers who achieve their goals, Bellabeat could develop a reward system. For example, customers get a longer Bellabeat membership if they achieve their goal every day for a week. In this way, it is not only easier to motivate people, but also help people to get to know the brand Bellabeat and their products better.

#### 6.4 Marketing strategy for the next step:
Because we have already know the targeted customers are lightly active women who sit more. So it would be wise if Bellbeat collect some information and data about these kind of customers. Bellabeat could analyse their habits and they daily routine, for example, do they watch more TV or computer. What kind of place do they usually go except for work. Do they use Youtube more or Facebook more. In this way, Bellabeat could consider where they should put advertisement to improve their KPI and reduce the ad cost.
